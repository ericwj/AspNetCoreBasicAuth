<Project ToolsVersion="15.0">
	<!-- Name is chosen such that the default .NET Core SDK behavior will override it -->
	<Target Name="GenerateAssemblyInfo" DependsOnTargets="SetSourceVersion" BeforeTargets="CoreCompile" Condition=" '$(GenerateAssemblyInfo)' == 'true' ">
		<MakeDir
				Directories="$(MSBuildProjectDirectory)\Properties"
				Condition="!Exists('$(MSBuildProjectDirectory)\Properties')"/>
		<ReadLinesFromFile
			File="$(MSBuildProjectDirectory)\Properties\AssemblyInfo.Generated.cs">
			<Output TaskParameter="Lines" PropertyName="AssemblyInfoFromDisk"/>
		</ReadLinesFromFile>

		<CreateProperty Value="//------------------------------------------------------------------------------;
			// %3Cauto-generated%3E;
			//     This code was generated by a tool.;
			//;
			//     Changes to this file may cause incorrect behavior and will be lost if;
			//     the code is regenerated.;
			// %3C/auto-generated%3E;
			//------------------------------------------------------------------------------;
			;
			using System.Reflection%3B;">
			<Output TaskParameter="Value" PropertyName="AssemblyInfoGenerated"/>
		</CreateProperty>
		<CreateProperty Condition=" '$(Product)' != '' " Value="$(AssemblyInfoGenerated);
			[assembly: AssemblyTitle(%22$(Product)%22)]">
			<Output TaskParameter="Value" PropertyName="AssemblyInfoGenerated"/>
		</CreateProperty>
		<CreateProperty Condition=" '$(Description)' != '' " Value="$(AssemblyInfoGenerated);
			[assembly: AssemblyDescription(%22$(Description)%22)]">
			<Output TaskParameter="Value" PropertyName="AssemblyInfoGenerated"/>
		</CreateProperty>
		<CreateProperty Condition=" '$(Company)' != '' " Value="$(AssemblyInfoGenerated);
			[assembly: AssemblyCompany(%22$(Company)%22)]">
			<Output TaskParameter="Value" PropertyName="AssemblyInfoGenerated"/>
		</CreateProperty>
		<CreateProperty Condition=" '$(Copyright)' != '' " Value="$(AssemblyInfoGenerated);
			[assembly: AssemblyCopyright(%22$(Copyright)%22)]">
			<Output TaskParameter="Value" PropertyName="AssemblyInfoGenerated"/>
		</CreateProperty>
		<CreateProperty Value="$(AssemblyInfoGenerated);
			[assembly: AssemblyVersion(%22$(VersionPrefix).$(Build_BuildId)%22)]">
			<Output TaskParameter="Value" PropertyName="AssemblyInfoGenerated"/>
		</CreateProperty>
		<CreateProperty Value="$(AssemblyInfoGenerated);
			[assembly: AssemblyFileVersion(%22$(VersionPrefix).$(Build_BuildId)%22)]">
			<Output TaskParameter="Value" PropertyName="AssemblyInfoGenerated"/>
		</CreateProperty>
		<CreateProperty Condition=" '$(VersionSuffix)' != '' " Value="$(AssemblyInfoGenerated);
			[assembly: AssemblyInformationalVersion(%22$(VersionPrefix)-$(VersionSuffix)+$(Build_SourceBranchName)-$(Build_SourceVersion)%22)]">
			<Output TaskParameter="Value" PropertyName="AssemblyInfoGenerated"/>
		</CreateProperty>
		<CreateProperty Condition=" '$(VersionSuffix)' == '' " Value="$(AssemblyInfoGenerated);
			[assembly: AssemblyInformationalVersion(%22$(VersionPrefix).$(Build_BuildId)+$(Build_SourceBranchName)-$(Build_SourceVersion)%22)]">
			<Output TaskParameter="Value" PropertyName="AssemblyInfoGenerated"/>
		</CreateProperty>
		
		<WriteLinesToFile
			Condition="'$(AssemblyInfoFromDisk)' != '$(AssemblyInfoGenerated)'"
			File="$(MSBuildProjectDirectory)\Properties\AssemblyInfo.Generated.cs"
			Encoding="utf-8"
			Lines="$(AssemblyInfoGenerated)"
			Overwrite="true"/>
	</Target>
</Project>